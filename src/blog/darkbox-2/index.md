---
title: 'Даркбокс 2'
date: 2009-02-19
tags: post
layout: post.njk
---

_Читайте про более новую версию скрипта в записи «[Возвращение Даркбокса](/blog/darkbox-return/)»_

Жизнь выдвигает новые требования, поэтому некоторые решения получают продолжение. Итак, перед вами продолжение экспериментов над одним простым, но очень полезным способом красиво открывать одиночные картинки. Более подробно об изначальной проблеме и первом варианте решения читайте в заметке «[Даркбокс](/blog/darkbox/)», а сейчас поговорим о даркбоксе номер два.

Для начала пример — [Даркбокс 2](demo/), всё в одном файле.

## Что нового, с виду

- Картинка большей ширины или высоты чем окно, будет автоматически подогнана под его размеры, чтобы пользователь не испугался и смог нажать заветный крестик. Попробуйте сильно уменьшить размер окна и снова открыть картинку.
- Датчик загрузки во всех нормальных браузерах, кроме Opera, обзавёлся скруглёнными уголками благодаря свойству `border-radius`.
- Крестики закрытия картинки теперь располагаются в наиболее удобных местах, в зависимости от платформы: на Маке — слева, на PC — справа.
- Теперь любой этап жизни даркбокса можно прервать при помощи клавиши <kbd>Esc</kbd>, на случай если вы передумали или кликнули случайно.

## Что нового, технически

Ну а чисто технически изменений не слишком много. В целом, код подрос примерно на сорок строк, большую часть из которых занимает мудрёное вписывание картинки в размеры окна. Помимо этого, сделана попытка сохранять создаваемый для дарбокса объект, чтобы клонировать и использовать его повторно для всех картинок. Не уверен, что это сильно повысило производительность, но попытка сделана:

    if(!$('div.darkbox-frame').length) {
        darkbox = $('<div class="darkbox-frame">…').appendTo('body');
    }
    var frame = darkbox.clone().appendTo('body');

Совместимость у скрипта прежняя, разве что тестирование в IE5 привело к JS-ошибке, но дело, скорее всего, в текущей версии jQuery. Думаю, что отряд не заметит потери бойца. Ну а Opera традиционно заставила прямо-таки создать картинку, а не просто приделать атрибут `src` к уже имеющемуся коду.

Другая проблема в IE, что тянется ещё с прошлой версии, случается во время анимации прозрачности блока с чёрным фоном от 0 до 50%. Суть её такова, что если описывать прозрачность в CSS при помощи `filter:alpha(opacity=N)`, то блок при появлении становится чёрным, потом абсолютно прозрачным и только потом начинается анимация. Видно это всего долю секунды, но осадочек остаётся. Трюк в стиле _добавим немного абсурда_, когда прозрачность добавляется к блоку при помощи JS, сработал, но снизил производительность всего решения. Поэтому вопрос открыт.

С интересом жду ваших мнений, замечаний и предложений. Разработка даркбокса продолжается…
